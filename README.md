# Highway Merge RL

自動運転における高速道路合流タスクの強化学習環境

## 概要

このプロジェクトは、高速道路での合流行動を学習するための強化学習環境を提供します。エージェントは合流車線から本線への安全な合流を学習し、交通車両との相互作用を考慮した意思決定を行います。

## 特徴

- **現実的な合流シナリオ**: 高速道路の合流ゾーン（300m-600m）での車線変更
- **交通車両との相互作用**: 動的な交通環境での合流行動
- **HighwayEnvスタイルの可視化**: プロフェッショナルで見やすい可視化
- **複数の学習アルゴリズム対応**: PPO、DQN等の強化学習アルゴリズム

## セットアップ

```bash
pip install gymnasium stable-baselines3 matplotlib numpy
```

## 使用方法

### 1. 学習
```bash
python train.py
```

### 2. 可視化デモ
```bash
# シンプルな可視化
python simple_demo.py

# 詳細な分析（比較・グラフ）
python visualize.py
```

### 3. Google Colab
Colabではパスを`/mnt/data/merge_rl`に設定し、`train.py`を実行

## 環境仕様

### 道路設定
- **道路長**: 1000m
- **合流ゾーン**: 300m-600m
- **車線**: 本線（上）・合流車線（下）

### エージェント行動
- **アクセル**: -1（減速）、0（維持）、1（加速）
- **車線変更**: 0（維持）、1（変更）

### 観測空間
8次元ベクトル：
- エージェント位置・速度
- 前後車両との距離・速度
- 合流ゾーン内フラグ
- 車線情報

### 報酬設計
- **進行報酬**: 前進距離
- **合流ボーナス**: 安全な合流成功
- **ペナルティ**: 衝突、急ブレーキ、クラクション

## 可視化機能

### HighwayEnvスタイル
- **ミニマルデザイン**: クリーンで見やすい表示
- **色分け**: エージェント（赤）、交通車両（青）
- **リアルタイム表示**: 車線変更の様子を視覚化
- **ステータス表示**: 位置、速度、車線情報

### 分析機能
- **学習済み vs ランダム**: パフォーマンス比較
- **行動分析**: 位置・速度・行動の時系列グラフ
- **統計情報**: 平均速度、車線変更回数等

## ファイル構成

```
highway-merge-rl/
├── envs/
│   └── merge_env.py          # 合流環境の実装
├── core/
│   ├── interfaces.py         # インターフェース定義
│   └── types.py             # データ型定義
├── physics/
│   └── simple.py            # 物理シミュレーション
├── train.py                 # 学習スクリプト
├── simple_demo.py           # シンプル可視化
├── visualize.py             # 詳細可視化・分析
└── README.md               # このファイル
```

## 参考

- [HighwayEnv](https://github.com/Farama-Foundation/HighwayEnv) - 可視化スタイルの参考
- [Stable Baselines3](https://stable-baselines3.readthedocs.io/) - 強化学習ライブラリ

## ライセンス

MIT License